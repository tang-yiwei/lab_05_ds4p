---
title: "Lab 05 - La Quinta is Spanish for next to Denny's, Pt. 2"
author: "Yiwei Tang"
date: "2/10/2026"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox) 
```

```{r load-data, message = FALSE}
states <- read_csv("data/states.csv")
```

### Exercise 1

There are three Denny's locations in Alaska.

```{r filter_dennys_AK}
dn_ak <- dennys %>%
  filter(state == "AK")
nrow(dn_ak)
```

There are two La Quinta locations in Alaska.

```{r filter_lq_AK}
lq_ak <- laquinta %>%
  filter(state == "AK")
nrow(lq_ak)
```

### Exercise 2

We need to calculate six locations between the two La Quintas and the three Denny's.

```{r calc_pair}
pair <- nrow(lq_ak) * nrow(dn_ak)
```

### Exercise 3

```{r join_sets}
dn_lq_ak <- full_join(dn_ak, lq_ak,
  by = "state"
)
```

### Exercise 4

There are six observations in the joined dn_lq_ak data frame. The variables are the address, city, zip, longitude, and latitude of both Denny's and La Quinta and the state, which is Alaska.

```{r abt_merged_set}
dim(dn_lq_ak)
colnames(dn_lq_ak)
```

### Exercise 5

To add a new variable to a data frame while keeping the existing variables, I will use the mutate() function from the tidyverse.

### Exercise 6

```{r cal_distance}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

  R <- 6371 # Earth mean radius in km

  a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
  d <- R * 2 * asin(sqrt(a))

  return(round(d, round)) # distance in km
}

dn_lq_ak <- dn_lq_ak %>% 
  mutate(
    distance = haversine(
      longitude.x,
      latitude.x,
      longitude.y,
      latitude.y
    )
  )
```

### Exercise 7

```{r min_dist}
dn_lq_ak_min_dist <- dn_lq_ak %>%
  group_by(address.x) %>% 
  summarise(min_dist = min(distance))
```

### Exercise 8

The distances between Denny's and the nearest La Quinta locations in Alaska range from 2.035 to 5.998 kilometers. The mean of the distance is 4.41 km, and the median is 5.197 km.

```{r discriptive_stat}
max(dn_lq_ak_min_dist$min_dist)
min(dn_lq_ak_min_dist$min_dist)
mean(dn_lq_ak_min_dist$min_dist)
median(dn_lq_ak_min_dist$min_dist)
```

```{r visual_dist}
dn_lq_ak_min_dist %>% 
  ggplot(
    aes(
      x = min_dist,
      y = reorder(address.x, min_dist)
    )
  ) +
  geom_bar(fill = "#99d8c9", stat = "identity") +
  labs(
    title = "Distance between each Denny's and the closest La Quinta to it in Alaska",
    x = "Distance (km)",
    y = "Address of Denny's"
  ) +
  theme_minimal() +
  theme(plot.title.position = "plot")
```

### Exercise 9

The distance between the Denny's in North Carolina and the closest La Quinta locations range from 1.779 km to 187.935 km. The average distance is 65.44 km, and the median is 53.46 km.

```{r visual_NC}
dn_nc <- dennys %>%
  filter(state == "NC")
lq_nc <- laquinta %>%
  filter(state == "NC")

dn_lq_nc <- full_join(dn_nc, lq_nc,
  by = "state"
)

dn_lq_nc <- dn_lq_nc %>% 
  mutate(
    distance = haversine(
      longitude.x,
      latitude.x,
      longitude.y,
      latitude.y
    )
  )

dn_lq_nc_min_dist <- dn_lq_nc %>%
  group_by(address.x) %>% 
  summarise(min_dist = min(distance))

dn_lq_nc_min_dist %>% 
  ggplot(
    aes(
      y = min_dist,
      x = reorder(address.x, min_dist)
    )
  ) +
  geom_bar(fill = "#fdbb84", stat = "identity") +
  labs(
    title = "Distance between each Denny's and the closest La Quinta to it in North Carolina",
    y = "Distance (km)",
    x = "Address of Denny's"
  ) +
  theme_minimal() +
  theme(plot.title.position = "plot",
        axis.text.x = element_text(
          angle = 45,
          hjust = 1,
          size = 8
        ))
```

```{r descrip_stat_NC}
max(dn_lq_nc_min_dist$min_dist)
min(dn_lq_nc_min_dist$min_dist)
mean(dn_lq_nc_min_dist$min_dist)
median(dn_lq_nc_min_dist$min_dist)
```

### Exercise 9

The distance between Denny's in Texas and their closest La Quinta locations range from 0.016 km to 60.582 km. The average distance is 5.79 km, and the median is 3.37 km. Since there's too many Denny's locations in Texas, it is very hard to show the address of all the individual locations.

```{r visual_TX}
dn_tx <- dennys %>%
  filter(state == "TX")
lq_tx <- laquinta %>%
  filter(state == "TX")

dn_lq_tx <- full_join(dn_tx, lq_tx,
  by = "state"
)

dn_lq_tx <- dn_lq_tx %>% 
  mutate(
    distance = haversine(
      longitude.x,
      latitude.x,
      longitude.y,
      latitude.y
    )
  )

dn_lq_tx_min_dist <- dn_lq_tx %>%
  group_by(address.x) %>% 
  summarise(min_dist = min(distance))

dn_lq_tx_min_dist %>% 
  ggplot(
    aes(
      y = min_dist,
      x = reorder(address.x, min_dist)
    )
  ) +
  geom_bar(fill = "#e34a33", stat = "identity") +
  labs(
    title = "Distance between each Denny's and the closest La Quinta to it in Texas",
    y = "Distance (km)",
    x = "Address of Denny's"
  ) +
  theme_minimal() +
  theme(plot.title.position = "plot",
        axis.text.x = element_text(
          angle = 90,
          hjust = 1,
          size = 3
        ))
```

```{r descrip_stat_TX}
max(dn_lq_tx_min_dist$min_dist)
min(dn_lq_tx_min_dist$min_dist)
mean(dn_lq_tx_min_dist$min_dist)
median(dn_lq_tx_min_dist$min_dist)
```

### Exercise 10

```{r visual_MI}
dn_mi <- dennys %>%
  filter(state == "MI")
lq_mi <- laquinta %>%
  filter(state == "MI")

dn_lq_mi <- full_join(dn_mi, lq_mi,
  by = "state"
)

dn_lq_mi <- dn_lq_mi %>% 
  mutate(
    distance = haversine(
      longitude.x,
      latitude.x,
      longitude.y,
      latitude.y
    )
  )

dn_lq_mi_min_dist <- dn_lq_mi %>%
  group_by(address.x) %>% 
  summarise(min_dist = min(distance))

dn_lq_mi_min_dist %>% 
  ggplot(
    aes(
      y = min_dist,
      x = reorder(address.x, min_dist)
    )
  ) +
  geom_bar(fill = "#9ecae1", stat = "identity") +
  labs(
    title = "Distance between each Denny's and the closest La Quinta to it in Michigan",
    y = "Distance (km)",
    x = "Address of Denny's"
  ) +
  theme_minimal() +
  theme(plot.title.position = "plot",
        axis.text.x = element_text(
          angle = 45,
          hjust = 1,
          size = 8
        ))
```

### Exercise 12

Among the states I examined, Mitch Hedberg's joke is most likely to hold true in Texas. The vast majority of the Denny's have its closest La Quinta locations within 10 km, while the other states have a greater average minimun distance when comparing with Taxes.